; (function ($){$.AjaxManager=function (el, options){var base=this; base.queuedRequests=[]; base.queuedDeferredRequests=[];base.activeRequests=[];base.$el=$(el);base.el=el;base.$el.data('AjaxManager', base);var defaultOptions={processRequests: true,maxRequests: 5,actionClassName: 'ajaxaction',loadingMarkup: '<div class="octaveLoad">Loading...</div>'}; base.options=$.extend(defaultOptions, options);base.init=function () {$(window).bind('unload', function () {base.destroy();});var $actions=$('.' + base.options.actionClassName);if ($actions != undefined && $actions.length > 0) {base.processActions($actions);base.start();}};base.start=function () {if (base.options.processRequests == true) {for (var i=0; i < base.options.maxRequests; i++) {var nextRequest=base.getNextRequestToExecute();if (nextRequest != null)base.executeRequest(nextRequest.url, nextRequest.target, nextRequest.contentaction, nextRequest.showload);}}};base.processActions=function ($actions, threadId) {for (i=0; i < $actions.length; i++) {var $action=$($actions[i]);if ($action.attr('id') != undefined) {var showLoadingDiv=$action.data('showload') != undefined ? $action.data('showload') : true;var deferred=$action.data('defer') != undefined ? $action.data('defer') : false;base.addNewRequest({url: $action.data('url'),target: $action.data('target') != undefined ? $action.data('target') : $action.attr('id'),contentaction: $action.data('contentaction') != undefined ? $action.data('contentaction') : 'replace',showload: showLoadingDiv}, deferred);} else {base.handleError();}}};base.addNewRequest=function (req, deferred) {if (!deferred) {base.queuedRequests.push(req); }else {base.queuedDeferredRequests.push(req);}};base.getNextRequestToExecute=function () {var nextRequest=null;if (base.queuedRequests.length > 0) {nextRequest=base.queuedRequests.shift();}else if (base.queuedDeferredRequests.length > 0) {nextRequest=base.queuedDeferredRequests.shift();}if (nextRequest != null) {if (base.queuedRequests.length == 0) {}}return nextRequest;};base.executeRequest=function (url, targetId, contentaction, showload) {if (base.options.processRequests == true) {var $target=$('#' + targetId);if (showload) {$target.append(base.options.loadingMarkup);}base.activeRequests.push($.ajax(url, {cache: false, success: function (data, status) {if (showload)$target.children().remove('div.octaveLoad');var $data=$(data);var $newActions=$data.find('.' + base.options.actionClassName);if ($newActions != undefined && $newActions.length > 0) {base.processActions($newActions);}try {if (contentaction != undefined && contentaction.toLowerCase() === 'append') {$target.append($data); }else {$target.replaceWith($data);}} catch (err) {$target.append('<div class="octaveError">Error!<br />The returned data was not in a correct format.</div>');base.handleError();}$data.each(function () {var $ele=$(this);if ($ele.is('script')) {}if ($ele.hasClass(base.options.actionClassName)) {var showLoadingDiv=true;if ($ele.data('showload') != undefined) {showLoadingDiv=$ele.data('showload');}base.addNewRequest({url: $ele.data('url'),target: $ele.data('target') != undefined ? $ele.data('target') : $ele.attr('id'),contentaction: $ele.data('contentaction') != undefined ? $ele.data('contentaction') : 'replace',showload: showLoadingDiv});}});},error: function (xhr, status, errorThrown) {if (showload)$target.children().remove('div.octaveLoad');if (status != 'abort' && (errorThrown.length > 0 || xhr.responseText.length > 0)) {var errormsg=errorThrown;var responseText=xhr.responseText;$target.append('<div class="octaveError">Error!<br />' + errormsg + '.</div>');base.handleError();}},complete: function (xhr, status) {var reqIndex=$.inArray(xhr, base.activeRequests);if (reqIndex > -1) {base.activeRequests.splice(reqIndex, 1);}var freeRequestCount=base.options.maxRequests - base.activeRequests.length;if (freeRequestCount > 0) {setTimeout(function () {var nextRequest=base.getNextRequestToExecute();if (nextRequest != null) {base.executeRequest(nextRequest.url, nextRequest.target, nextRequest.contentaction, nextRequest.showload);}}, 1000);}}}));}};base.handleError=function (){};base.killAllRequests=function () {base.options.processRequests=false;$.each(base.activeRequests, function (index, req) {try {req.abort();}catch (err){}});};base.destroy=function () {base.killAllRequests();activeRequests=null;queuedRequests=null;};base.init();};$.fn.AjaxManager=function (options) {return this.each(function () {(new $.AjaxManager(this, options));});};})(jQuery);